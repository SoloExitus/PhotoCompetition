{% extends 'competition/base.html' %}

{% load static %}
{% block header %}
    <ul class="nav col-12 col-lg-auto me-lg-auto mb-2 justify-content-center mb-md-0">
      <li><a href="{% url 'main' %}" class="nav-link px-2 link-dark">Competition</a></li>
    </ul>

    <form class="col-12 col-lg-auto mb-3 mb-lg-0 me-lg-3">
      <input type="search" class="form-control" placeholder="Search..." aria-label="Search">
    </form>

    <div class="dropdown text-end">
        {% if request.user.is_authenticated %}
        <a href="#" class="d-block link-dark text-decoration-none dropdown-toggle" id="dropdownUser1" data-bs-toggle="dropdown" aria-expanded="false">
            {{ request.user.username }}
                <img src="{{ request.user.profile_image }}" alt="thumbnail" width="32" height="32" class="rounded-circle">
        </a>
      <ul class="dropdown-menu text-small" aria-labelledby="dropdownUser1">
        <li><a class="dropdown-item" href="{% url 'profile' %}">Profile</a></li>
          <li><a class="dropdown-item" href="{% url 'add' %}">Create Post</a></li>
        <li><hr class="dropdown-divider"></li>
        <li>
            <a class="dropdown-item" href="{% url 'logout' %}">Sign out</a>
        </li>
      </ul>
        {% else %}
        <p>
            <a href="{% url 'social:begin' 'github' %}">Login with Github</a>
        </p>
        {% endif %}
    </div>
{% endblock header %}


{% block main %}
<!-- Page Content -->
    <div class="col-md-10">
        <div class="row justify-content-around gallery">
        </div>
    </div>

{% endblock main %}

{% block customjs %}
<script>
    $(document).ready(function() {
    $.ajax({
      url: "{% url 'api:gallery-list' %}",
      type: "GET",
      dataType: "json",
       success: (data) => {
          const gallery = $(".gallery");
          gallery.empty()

           const urlpost= "{% url 'post' 0 %}".slice(0, -1)

          data.forEach(postData => {

            const post = `
            <div class=" col-md-4 col-6 card" >
                <div class="card-header">
                    ${postData.title}

                    <a href="${urlpost + postData.id}" class="d-block mb-4 h-100">
                        <img class="img-fluid img-thumbnail" src="${postData.full_image}"  width="100%" alt="${postData.title}">
                    </a>
                </div>
                <div class="card-body container">
                    <div class="d-flex flex-row justify-content-between">
                        <div class="block">
                            <img src="{% static '/img/like.png' %}" width="20px"> ${postData.likes_count}
                        </div>
                        <div class="block">
                            <img src="{% static '/img/chat.png' %}" width="20px">${postData.comments_count}
                        </div>
                    </div>
                </div>

            </div>`

            gallery.append(post);
          });
        },
          error: (error) => {
            console.log(error);
          }
    });
    });
</script>
{% endblock customjs %}